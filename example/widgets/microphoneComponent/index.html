<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Mindmeld-Microphone Example</title>
    <script src="//cdnjs.cloudflare.com/ajax/libs/polymer/0.3.4/platform.js"></script>
    <script src="../../../dist/sdk/mindmeld.js"></script>
    <link rel="import" href="../../../dist/widgets/microphoneComponent/mindmeld-microphone.html">
</head>
<body>
    <h2>The MindMeld Microphone Widget</h2>
    <mindmeld-microphone id="exampleMic"></mindmeld-microphone>
    <script>
        'use strict';

        document.addEventListener('DOMContentLoaded', function exampleMindmeldMicrophone () {
            var microphone = document.getElementById('exampleMic');

            // initialize MM
            var config = {
                appid: '7d6d5d9a76691f2dee36dcc28b77ed83a8ba1e1e',
                onInit: onMMInit
            };
            MM.init(config);

            function onMMInit () {
                MM.setToken('8c79855564e9ac48da1b95c825af1c61148b8a26', onTokenSet);
            }

            function onTokenSet () {
                MM.setActiveUserID('6153');
                MM.setActiveSessionID('182935');
                onMMReady();
            }

            function onMMReady () {
                console.log('MM token and session ready');

                subscribeToMicEvents();
                microphone.initialize();
            }

            function subscribeToMicEvents () {
                microphone.on('init',
                    function onMicInit () {
                        console.log('mic init');
                    }
                );

                microphone.on('result',
                    function onMicResult (result, resultIndex, results, event) {
                        console.log('mic result: ' + result.transcript);
                    }
                );

                microphone.on('error',
                    function onMicError (error) {
                        console.error('mic error: ' + error);
                    }
                )
            }



            // Unused helper functions

            function getToken () {
                var simpleUserCredentials = {
                    appsecret: '25ba4e936667fe4268fc7b9e3f5a7cf6bf9f6699',
                    simple: {
                        userid: 'einstein80',
                        name: 'Albert Einstein'
                    }
                };
                MM.getToken(simpleUserCredentials, onTokenSet);
            }

            function createSession () {
                var newSessionData = {
                    name: 'new session name',
                    privacymode: 'inviteonly'
                };
                MM.activeUser.sessions.post(newSessionData,
                    function onSessionCreated (response) {
                        console.log('session created: ', response);
                        MM.setActiveSessionID(response.data.sessionid);
                    }
                );
            }
        });
    </script>
</body>
</html>